<?php
class ControllerStoreSinglestorepage extends Controller{
     public function index(){
		
		if (($this->request->server['REQUEST_METHOD'] == 'POST')) {
		$to="deepeshurbanwood@gmail.com";
		$subject="Request Callback enquiry";
		$senderName = 'Urbanwood Furniture';
		$senderEmail = 'support@urbanwood.in';
	 
		$from = stripslashes($senderName)."<".stripslashes($senderEmail).">";
	  
		$mime_boundary="==Multipart_Boundary_x".md5(mt_rand())."x";
	 
		
		$headers = "From: $from\r\n" . 
		"MIME-Version: 1.0\r\n" .
		"Content-Type: multipart/mixed;\r\n" .
	   " boundary=\"{$mime_boundary}\"";
		 if(isset($_POST["time_slot"]) || isset($_POST["date"])){
			 $message="Enquiry For Furniture (Request Callback)\n\n";
			 $message .= "Name:".$_POST["name"]."\n"."EMail:".$_POST['email']."\nMobile:".$_POST['mobile']."\nTime Slot:".$_POST["time_slot"]."\nDate:".$_POST["date"]."\nLooking For:".$_POST["message"];
		 }else{
			 $message="Enquiry For Furniture (Contact Form)\n\n";
			 $message .= "Name:".$_POST["name"]."\n"."EMail:".$_POST['email']."\nMobile:".$_POST['mobile']."\nLooking For:".$_POST["message"];
		 }
		 $message = "This is a multi-part message in MIME format.\n\n" .
		 "--{$mime_boundary}\n" .
		 "Content-Type: text/plain; charset=\"iso-8859-1\"\n" .
		 "Content-Transfer-Encoding: 7bit\n\n" .
		  $message . "\n\n";
	 
		$i=0;
	  $message.="--{$mime_boundary}--\n";
	   if (@mail($to, $subject, $message, $headers)){
		  echo 'Service Working';exit;
	   }else{
		  echo 'Service Error ' . error_get_last()['message'];exit;
	   }

	}
      $this->load->model('localisation/location');

      $location_id = $this->request->get['s_id'];
      $location_info = $this->model_localisation_location->getLocation($location_id);

			if ($location_info) {
				if ($location_info['image']) {
					$image = $this->model_tool_image->resize($location_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_location_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_location_height'));
				} else {
					$image = false;
				}

				$data['locations'] = array(
					'location_id' => $location_info['location_id'],
					'name'        => $location_info['name'],
					'address'     => nl2br($location_info['address']),
					'geocode'     => $location_info['geocode'],
					'telephone'   => $location_info['telephone'],
					'fax'         => $location_info['fax'],
					'image'       => $image,
					'open'        => nl2br($location_info['open']),
					'comment'     => $location_info['comment']
				);
			}

$data['locationList'] = array();
foreach((array)$this->config->get('config_location') as $location_id) {
	$location_info = $this->model_localisation_location->getLocation($location_id);

	if ($location_info) {
		if ($location_info['image']) {
			$image = $this->model_tool_image->resize($location_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_location_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_location_height'));
		} else {
			$image = false;
		}

		$data['locationList'][] = array(
			'location_id' => $location_info['location_id'],
			'name'        => $location_info['name'],
		);
	}
}
print_r($data['locationList']);
        $data['header'] = $this->load->controller('common/header');  
        $data['footer'] = $this->load->controller('common/footer');  
        $data['menu'] = $this->load->controller('common/menu');  
        $data['singlestorehead'] = $this->load->controller('store/singlestorehead');  
        $data['storedetail'] = $this->load->controller('store/storedetail'); 
        $data['catelogrequest'] = $this->load->controller('store/catelogrequest'); 
        $data['customerstories'] = $this->load->controller('store/customerstories'); 
        $data['bottomcontent'] = $this->load->controller('store/bottomcontent');  
          
        
        $this->response->setOutput($this->load->view('store/singlestorepage', $data));
     }
}
?>